---
layout: lesson
title: CASE WHEN
previous_lesson: /lessons/offset/
next_lesson: /lessons/common-aggregation-functions/
---

<p><img src="images/case-when.png" class="illustration" /></p>

<h3 class="h3-big-margin"><span class="grey-text-span">Calculated columns</span></h3>
<p>Earlier, we saw the use simple calculated columns:</p>
<pre>
  <code class="language-sql">
SELECT  id,
        name,
        cost,
        cost * 1.2 AS increased_cost
  FROM  bigquery-public-data.thelook_ecommerce.products;
  </code>
</pre>
<p><img src="images/calculated-columns.png" class="lesson-img" /></p>

<h3 class="h3-big-margin"><span class="grey-text-span">Calculated columns with conditional values</span></h3>
<p>The CASE expression can be used to attribute conditional values, with a if..else logic. The conditions are evaluated from top to bottom and the evaluation stops as soon as a true condition is met.</p>
<pre>
  <code class="language-sql">
SELECT  id,
        name,
        cost,
        cost * 1.2 AS increased_cost,
        CASE
          WHEN cost > 500 THEN cost * 1.6
          WHEN cost BETWEEN 401 AND 500 THEN cost * 1.5
          WHEN cost BETWEEN 301 AND 400 THEN cost * 1.4
          WHEN cost BETWEEN 201 AND 300 THEN cost * 1.3
          WHEN cost BETWEEN 101 AND 200 THEN cost * 1.2
          ELSE cost * 1.1
        END AS proportional_increased_cost
  
FROM  bigquery-public-data.thelook_ecommerce.products;
  </code>
</pre>
<p><img src="images/calculated-columns-with-conditional-values.png" class="lesson-img" /></p>

<h3 class="h3-big-margin"><span class="grey-text-span">Calculated columns for labelling</span></h3>
<p>It is also very useful to group values into labels:</p>
<pre>
  <code class="language-sql">
SELECT  id,
        name,
        retail_price,
        CASE
          WHEN retail_price >= 500 THEN 'expensive'
          WHEN retail_price BETWEEN 100 AND 499 THEN 'normal'
          ELSE 'cheap'
        END AS retail_price_tier
  
FROM  bigquery-public-data.thelook_ecommerce.products;
  </code>
</pre>
<p><img src="images/calculated-columns-for-labelling.png" class="lesson-img" /></p>


<!-- PRACTICE PROBLEMS -->
{% include practice_problems_intructions.html %}

<h3 class="h3-big-margin"><span class="easy-problem-text-span">N¬∞1 ‚Äî Cleanup of the users table‚Äôs country column&nbsp;üßÇ</span></h3>
<div class="problem">
  <h4>Tables</h4>
  <p>bigquery-public-data.thelook_ecommerce.users</p>

  <h4>Task</h4>
  <ul>
    <li>Write a query that will fix the issues that exist with the current country column.</li>
    <li>Create a new column called <i>clean_country</i> where <i>Espa√±a</i> is replaced with Spain and Deutschland replaced with Germany using a CASE expression.</li>
    <li>Show only rows where country is either Espa√±a or Deutschland.</li>
  </ul>
  
  <h4>Example results</h4>
  <p><img src="images/result-1.png" class="lesson-img" /></p>

  <h4>Solution</h4>
  <div class="collapsible-parent">
    <p><a href="#" class="hide-control">üôà Hide</a><a href="#" class="show-control">üëÄ Show</a></p>
    <div class="practice-problems-instructions collapsible-item">
      <pre>
        <code class="language-sql">
SELECT  id,
        email,
        country,
        CASE
          WHEN country = 'Espa√±a' THEN 'Spain'
          WHEN country = 'Deutschland' THEN 'Germany'
          ELSE country
        END AS clean_country
  
  FROM  bigquery-public-data.thelook_ecommerce.users
  WHERE country IN ('Espa√±a', 'Deutschland');
        </code>
      </pre>
    </div>
  </div>
</div>


<h3 class="h3-big-margin"><span class="medium-problem-text-span">N¬∞2 ‚Äî New full_state_name column in the distribution_centers table&nbsp;&nbsp;üå∂Ô∏è</span></h3>
<div class="problem">
  <h4>Tables</h4>
  <p>bigquery-public-data.thelook_ecommerce.distribution_centers</p>

  <h4>Task</h4>
  <ul>
    <li>Write a query that will display a new column called full_state_name that will show the full name of the distribution center‚Äôs state.</li>
    <li>Your solution should still work when new distribution centers from states already in the table are added.</li>
    <li>For row 6, the full state name should be <i>New York/New Jersey</i>.</li>
    <li>Sort the rows by full_state_name in ascending order.</li>
  </ul>
  
  <h4>Example results</h4>
  <p><img src="images/result-2.png" class="lesson-img" /></p>

  <h4>Solution</h4>
  <div class="collapsible-parent">
    <p><a href="#" class="hide-control">üôà Hide</a><a href="#" class="show-control">üëÄ Show</a></p>
    <div class="practice-problems-instructions collapsible-item">
      <pre>
        <code class="language-sql">
SELECT      id,
						name,
						latitude,
						longitude,
            CASE
              WHEN name LIKE '% TN' THEN 'Tennessee'
              WHEN name LIKE '% IL' THEN 'Illinois'
              WHEN name LIKE '% TX' THEN 'Texas'
              WHEN name LIKE '% CA' THEN 'California'
              WHEN name LIKE '% LA' THEN 'Louisiana'
              WHEN name LIKE '% NY/NJ' THEN 'New York/New Jersey'
              WHEN name LIKE '% PA' THEN 'Pennsylvania'
              WHEN name LIKE '% AL' THEN 'Alabama'
              WHEN name LIKE '% SC' THEN 'South Carolina'
              WHEN name LIKE '% GA' THEN 'Georgia'
            END AS full_name_state
  
  FROM      bigquery-public-data.thelook_ecommerce.distribution_centers
  ORDER BY  full_name_state ASC;
        </code>
      </pre>
    </div>
  </div>
</div>
