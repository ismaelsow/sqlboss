---
layout: lesson
title: RANK
previous_lesson: /lessons/ntile/
next_lesson: /lessons/dense-rank/
---

<p><img src="images/rank.png" class="illustration" /></p>

<p><code>RANK</code> is similar to the <a href="/lessons/row-number/">ROW_NUMBER (ranking window function)</a> but its output is based on the value of the ranking column used in the ORDER BY inside the OVER clause. The rank may not be consecutive (for example, jumping from 1 to 5), taking into account rows with the same rank.</p>

<h3 class="h3-big-margin"><span class="grey-text-span">Example</span></h3>
<pre>
  <code class="language-sql">
SELECT    category,
          id,
          TRUNC(retail_price, 2) AS retail_price,
          RANK() OVER (PARTITION BY category ORDER BY retail_price DESC) AS order_size_rank
  
  FROM    bigquery-public-data.thelook_ecommerce.products
ORDER BY  category ASC;
  </code>
</pre>
<p><img src="images/example-1.png" class="lesson-img" /></p>

<h3 class="h3-big-margin"><span class="grey-text-span">Learn more</span></h3>
<p><a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/numbering_functions#rank" target="_blank">üëâ Check out the official documentation</a></p>


<!-- PRACTICE PROBLEMS -->
{% include practice_problems_intructions.html %}

<h3 class="h3-big-margin"><span class="medium-problem-text-span">N¬∞1 ‚Äî 3 oldest people per country&nbsp;&nbsp;üå∂Ô∏è</span></h3>
<div class="problem">
  <h4>Tables</h4>
  <p>bigquery-public-data.thelook_ecommerce.users</p>

  <h4>Task</h4>
  <ul>
    <li>Write a query that will display the full name of the three oldest people per country.</li>
    <li>In case of ties for the ranking function, sort by full name and by sign up date in ascending order</li>
    <li>The final results should be sorted by country and age rank in ascending order</li>
  </ul>
  
  <h4>Example results</h4>
  <p><img src="images/result-1.png" class="lesson-img" /></p>

  <h4>Solution</h4>
  <div class="collapsible-parent">
    <p><a href="#" class="hide-control">üôà Hide</a><a href="#" class="show-control">üëÄ Show</a></p>
    <div class="practice-problems-instructions collapsible-item">
      <pre>
        <code class="language-sql">
WITH age_ranked_country_users AS
  ( SELECT  country,
            CONCAT(first_name, ' ', last_name) AS full_name,
            age,
            RANK() OVER (PARTITION BY country ORDER BY age DESC, CONCAT(first_name, ' ', last_name) ASC, created_at ASC) AS age_rank
      FROM  bigquery-public-data.thelook_ecommerce.users
  )

SELECT      country,
            full_name,
            age,
            age_rank
  
  FROM      age_ranked_country_users
  WHERE     age_rank IN (1, 2, 3)
  ORDER BY  country ASC, age_rank ASC;
        </code>
      </pre>
    </div>
  </div>
</div>
